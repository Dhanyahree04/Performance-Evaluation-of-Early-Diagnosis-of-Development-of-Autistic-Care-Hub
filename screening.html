<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Autism Care Hub - Basic Information</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body {
      background: linear-gradient(120deg, #6b46c1, #eba7ec, #d6bcfa, #6db8e7);
      background-size: 400% 400%;
      animation: galaxyFlow 12s ease infinite;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    @keyframes galaxyFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .cloud-bg {
      background-color: rgba(255, 255, 255, 0.85);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.15);
    }

    .progress-bar {
      height: 8px;
      width: 100%;
      background-color: #e5e7eb;
      border-radius: 5px;
      margin-bottom: 20px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #4d21b5, #917cbb, #d6bcfa, #1c0e3b);
      background-size: 400% 400%;
      animation: galaxyFlow 6s ease infinite;
      border-radius: 5px;
      width: 0%;
      transition: width 0.4s ease-in-out;
    }

    .selected-answer {
      background-color: #a0aec0 !important;
    }

    main {
      flex: 1;
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="bg-gradient-to-r from-blue-400 to-blue-300 text-gray-800 sticky top-0 z-50 shadow-md">
    <nav class="max-w-7xl mx-auto flex justify-between items-center py-4 px-6">
      <div class="text-3xl font-bold tracking-wide">Autism Care Hub</div>
      <div class="space-x-6 font-medium hidden md:flex">
        <a href="index.html" class="hover:text-white">Home</a>
        <a href="index.html#about" class="hover:text-white">About Us</a>
        <a href="index.html#contact" class="hover:text-white">Contact Us</a>
      </div>
    </nav>
  </header>

  <!-- Main Content -->
  <main class="flex justify-center items-center py-10 px-4">
    <div id="screening" class="cloud-bg w-full max-w-2xl p-8">
      <h1 class="text-3xl font-bold mb-8 text-center text-purple-800">Autism Care Hub - Basic Information</h1>

      <!-- Progress Bar -->
      <div class="progress-bar mb-4">
        <div id="progress-bar-fill" class="progress-bar-fill"></div>
      </div>

      <!-- Age Input -->
      <div id="age-form" class="mb-6">
        <label class="block font-semibold mb-2 text-gray-700">Enter your age</label>
        <input type="number" id="age" class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-purple-400" required placeholder="Enter your age" min="1" max="100" />
        <button id="next-age-btn" class="mt-4 w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-semibold">Next</button>
      </div>

      <!-- Screening Info -->
      <div id="screening-info" class="hidden mb-6">
        <p id="screening-message" class="text-xl text-center text-gray-700 mb-4"></p>
        <button id="start-screening-btn" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-semibold">Start Screening</button>
      </div>

      <!-- Screening Form -->
      <form id="screening-form" class="space-y-6 hidden">
        <h2 id="screening-title" class="text-2xl font-bold text-center text-purple-800 mb-4"></h2>
        <div id="questions-container"></div>
        <div class="flex justify-between">
          <button type="button" id="prev-btn" class="w-1/3 bg-gray-400 text-white py-2 rounded-lg hover:bg-gray-500 hidden">Previous</button>
          <button type="button" id="next-btn" class="w-1/3 bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 hidden">Next</button>
        </div>
      </form>

      <div id="loading" class="text-center mt-6 hidden text-purple-700 font-semibold">Processing...</div>
    </div>
  </main>

  <!-- Footer -->
  <footer id="contact" class="bg-gray-900 text-white py-6 px-6 text-center text-sm">
    <div class="max-w-7xl mx-auto">
      <p class="mb-2">Quick Links:
        <a href="#" class="text-gray-400 hover:text-white mx-1">Home</a> |
        <a href="#resources" class="text-gray-400 hover:text-white mx-1">Resources</a>
      </p>
      <p>Email: <a href="mailto:trixietriesit247@gmail.com" class="hover:text-white underline">support@autismcarehub.com</a></p>
      <p class="italic mt-2">"Every person deserves to be seen, heard, and supported."</p>
      <p class="text-gray-500 mt-1">&copy; 2025 Autism Care Hub</p>
    </div>
  </footer>

  <!-- JavaScript -->
  <script>
    const ageInput = document.getElementById('age');
    const nextAgeBtn = document.getElementById('next-age-btn');
    const screeningInfoDiv = document.getElementById('screening-info');
    const screeningMessage = document.getElementById('screening-message');
    const startScreeningBtn = document.getElementById('start-screening-btn');
    const screeningForm = document.getElementById('screening-form');
    const questionsContainer = document.getElementById('questions-container');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const submitBtn = document.getElementById('submit-btn');
    const progressBarFill = document.getElementById('progress-bar-fill');
    const loadingDiv = document.getElementById('loading');

    // Participant information form
    const infoForm = `
      <div id="info-form" class="space-y-4 mb-6">
        <div>
          <label class="block font-semibold mb-2 text-gray-700">Full Name</label>
          <input type="text" id="name" class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-purple-400" required placeholder="Enter your full name" />
        </div>
        <div>
          <label class="block font-semibold mb-2 text-gray-700">Gender</label>
          <select id="gender" class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-purple-400">
            <option value="">Select gender</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
            <option value="prefer-not-to-say">Prefer not to say</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold mb-2 text-gray-700">Ethnicity</label>
          <input type="text" id="ethnicity" class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-purple-400" placeholder="Enter your ethnicity" />
        </div>
        <button id="next-info-btn" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-semibold">Next</button>
      </div>
    `;

    let currentQuestionIndex = 0;
    let answers = [];
    let participantInfo = {};

    // Initialize participant info
    function initializeParticipantInfo() {
      participantInfo = {
        name: '',
        gender: '',
        ethnicity: '',
        age: ''
      };
    }

    // Load questions
    function loadQuestions() {
      // Add your questions here
      const questions = [
        {
          text: "Does your child maintain eye contact while interacting with others?",
          options: ["Yes", "No"]
        },
        {
          text: "Does your child play or interact with other children, or does your child prefer to play alone?",
          options: ["Yes", "No"]
        },
        {
          text: "Does your child react unusually to sudden loud noises or bright lights?",
          options: ["Yes", "No"]
        },
        {
          text: "Does your child repeat words or phrases without understanding their meaning (echolalia)?",
          options: ["Yes", "No"]
        },
        {
          text: "Does your child respond when called by name?",
          options: ["Yes", "No"]
        },
        {
          text: "Has your child ever lost previously acquired language abilities?",
          options: ["Yes", "No"]
        },
        {
          text: "Does your child get upset when routines or familiar patterns are changed?",
          options: ["Yes", "No"]
        },
        {
          text: "Does your child focus excessively on parts of toys or objects (e.g., spinning wheels)?",
          options: ["Yes", "No"]
        },
        {
          text: "Does your child use gestures (like pointing or pulling your hand) to express needs?",
          options: ["Yes", "No"]
        },
        {
          text: "Does your child show fear or anxiety that seems exaggerated or without a clear reason?",
          options: ["Yes", "No"]
        }
      ];
      return questions;
    }

    // Event listeners
    nextAgeBtn.addEventListener('click', () => {
      if (ageInput.value) {
        participantInfo.age = ageInput.value;
        screeningInfoDiv.style.display = 'block';
        ageForm.style.display = 'none';
      }
    });

    startScreeningBtn.addEventListener('click', () => {
      screeningForm.innerHTML = infoForm;
      screeningInfoDiv.style.display = 'none';
      document.getElementById('next-info-btn').addEventListener('click', handleNextInfo);
    });

    function handleNextInfo() {
      const name = document.getElementById('name').value;
      const gender = document.getElementById('gender').value;
      const ethnicity = document.getElementById('ethnicity').value;

      if (!name || !gender) {
        alert('Please fill in all required fields');
        return;
      }

      participantInfo.name = name;
      participantInfo.gender = gender;
      participantInfo.ethnicity = ethnicity;
      
      screeningForm.innerHTML = '';
      screeningForm.classList.remove('hidden');
      loadQuestion();
    }

    function loadQuestion() {
      const questions = loadQuestions();
      if (currentQuestionIndex >= questions.length) {
        submitBtn.style.display = 'block';
        nextBtn.style.display = 'none';
        return;
      }

      const question = questions[currentQuestionIndex];
      questionsContainer.innerHTML = `
        <p class="text-lg text-gray-700 mb-4">${question.text}</p>
        <div class="space-y-2">
          ${question.options.map(option => `
            <button class="w-full p-3 rounded-lg border border-gray-300 hover:bg-gray-50 focus:ring-2 focus:ring-purple-400"
                    onclick="selectAnswer('${option}')">${option}</button>
          `).join('')}
        </div>
      `;

      // Update progress bar
      const progress = ((currentQuestionIndex / questions.length) * 100).toFixed(1);
      progressBarFill.style.width = `${progress}%`;
    }

    function selectAnswer(answer) {
      answers[currentQuestionIndex] = answer;
      nextBtn.style.display = 'block';
    }

    prevBtn.addEventListener('click', () => {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        loadQuestion();
      }
    });

    nextBtn.addEventListener('click', () => {
      if (currentQuestionIndex < loadQuestions().length - 1) {
        currentQuestionIndex++;
        loadQuestion();
      }
    });

    submitBtn.addEventListener('click', saveToGoogleSheets);

    function saveToGoogleSheets() {
      try {
        loadingDiv.classList.remove('hidden');
        
        // Calculate test result
        const yesCount = answers.filter(ans => ans === "Yes").length;
        const timestamp = new Date().toISOString();

        // Prepare data
        const data = {
          name: participantInfo.name,
          gender: participantInfo.gender,
          ethnicity: participantInfo.ethnicity,
          age: participantInfo.age,
          test_result: yesCount,
          timestamp: timestamp
        };

        // Send to backend
        fetch('http://localhost:5000/save-screening', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
          if (result.status === 'success') {
            // Store answers in localStorage
            localStorage.setItem('answers', JSON.stringify(answers));
            window.location.href = 'result.html';
          } else {
            throw new Error(result.message);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Failed to save data. Please try again later.');
          loadingDiv.classList.add('hidden');
        });
      } catch (error) {
        console.error('Error:', error);
        alert('Failed to save data. Please try again later.');
        loadingDiv.classList.add('hidden');
      }
    }

    // Initialize
    initializeParticipantInfo();
    loadQuestion();
    startScreeningBtn.addEventListener('click', () => {
      const age = parseInt(ageInput.value);
      questions = age < 18 ? childQuestions : adultQuestions;
      screeningTitle.textContent = age < 18 ? "Screening for Autism - Child" : "Screening for Autism - Adult";
      document.getElementById('age-form').classList.add('hidden');
      screeningInfoDiv.classList.add('hidden');
      form.classList.remove('hidden');
      currentQuestionIndex = 0;
      selectedAnswers = [];
      loadQuestion();
    });

    function loadQuestion() {
      if (currentQuestionIndex >= questions.length) {
        submitForm();
        return;
      }

      const previousAnswer = selectedAnswers[currentQuestionIndex];
      questionsContainer.innerHTML = `
        <label class="font-medium text-gray-700 mb-4 block">${currentQuestionIndex + 1}. ${questions[currentQuestionIndex]}</label>
        <div class="flex space-x-4">
          <button type="button" id="yes-btn" class="w-1/2 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 ${previousAnswer === 'yes' ? 'selected-answer' : ''}">Yes</button>
          <button type="button" id="no-btn" class="w-1/2 bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 ${previousAnswer === 'no' ? 'selected-answer' : ''}">No</button>
        </div>
      `;

      document.getElementById('yes-btn').addEventListener('click', () => selectAnswer('yes'));
      document.getElementById('no-btn').addEventListener('click', () => selectAnswer('no'));

      progressBarFill.style.width = `${(currentQuestionIndex / questions.length) * 100}%`;
      prevBtn.style.display = currentQuestionIndex === 0 ? 'none' : 'inline-block';
      nextBtn.style.display = previousAnswer ? 'inline-block' : 'none';
    }

    function selectAnswer(answer) {
      selectedAnswers[currentQuestionIndex] = answer;
      nextBtn.style.display = 'inline-block';

      document.getElementById('yes-btn').classList.remove('selected-answer');
      document.getElementById('no-btn').classList.remove('selected-answer');

      if (answer === 'yes') {
        document.getElementById('yes-btn').classList.add('selected-answer');
      } else {
        document.getElementById('no-btn').classList.add('selected-answer');
      }
    }

    prevBtn.addEventListener('click', () => {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        loadQuestion();
      }
    });

    nextBtn.addEventListener('click', () => {
      currentQuestionIndex++;
      loadQuestion();
    });

    function submitForm() {
      loadingDiv.classList.remove('hidden');
      setTimeout(() => {
        localStorage.setItem('answers', JSON.stringify(selectedAnswers));
        window.location.href = 'result.html';
      }, 1000);
    }
  </script>
</body>
</html>
